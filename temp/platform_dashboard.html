<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform Dashboard - FromHorizon</title>
    <link rel="stylesheet" href="platform_dashboard.css">
</head>
<body>
    <header>
        <h1>üè¶ Platform Dashboard</h1>
        <a href="{{ url_for('logout') }}" class="logout">Logout</a>
    </header>

    <div class="dashboard-info">
        <p><strong>üè¶ Total Fees Collected:</strong> ‚Çπ{{ balance }}</p>
    </div>

   

    <h3>üìú Fee Transaction History</h3>
    <div class="search-box">
        <input type="text" id="search" onkeyup="searchTransactions()" placeholder="Search transactions...">
    </div>
    <table id="transactionTable">
        <thead>
            <tr>
                <th>Type</th>
                <th>User(s)</th>
                <th>Tokens/Energy</th>
                <th>Basic Cost</th>
                <th>Platform Fee(s)</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transactions %}
                <tr>
                    <td>{{ transaction.data.type }}</td>
                    <td>
                        {% if transaction.data.type == 'production' %}
                            {{ transaction.data.username }}
                        {% elif transaction.data.type == 'transfer' %}
                            {{ transaction.data.sender }} ‚Üí {{ transaction.data.recipient }}
                        {% endif %}
                    </td>
                    <td>
                        {% if transaction.data.type == 'production' %}
                            {{ transaction.data.energy }} kWh
                        {% elif transaction.data.type == 'transfer' %}
                            {{ transaction.data.tokens }} tokens
                        {% endif %}
                    </td>
                    <td>‚Çπ{{ transaction.data.get('basic_cost', 0)|default(0)|round(2) }}</td>
                    <td>
                        {% if transaction.data.type == 'production' %}
                            ‚Çπ{{ transaction.data.get('platform_fee', 0)|default(0)|round(2) }}
                        {% elif transaction.data.type == 'transfer' %}
                            Buyer: ‚Çπ{{ transaction.data.get('buyer_platform_fee', 0)|default(0)|round(2) }}<br>
                            Producer: ‚Çπ{{ transaction.data.get('producer_platform_fee', 0)|default(0)|round(2) }}
                        {% endif %}
                    </td>
                    <td>{{ transaction.timestamp|datetime }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function searchTransactions() {
            let input = document.getElementById("search").value.toLowerCase();
            let rows = document.querySelectorAll("#transactionTable tbody tr");
            rows.forEach(row => {
                let text = row.textContent.toLowerCase();
                row.style.display = text.includes(input) ? "" : "none";
            });
        }
    </script>
</body>
</html>
